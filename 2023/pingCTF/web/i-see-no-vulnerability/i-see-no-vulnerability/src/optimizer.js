import { readdir, unlink } from "fs/promises";
import { visionedDict } from "./index.js";

const DELETE_INTERVAL_MS = 60 * 1000;

export const startDeleting = () => {
	console.log(`Starting to delete files every ${DELETE_INTERVAL_MS}ms.`);
	setInterval(async () => {
		const files = await readdir("./images");
		let i = 0;
		for (const file of files) {
			if (file.endsWith(".keep")) continue;
			i++;
			await unlink(`./images/${file}`);
			delete visionedDict[file.split(".")[0]];
		}
		console.log(`Deleted ${i} files.`);
	}, DELETE_INTERVAL_MS);
};
