

# This file was *autogenerated* from the file solve_good.sage
from sage.all_cmdline import *   # import sage library

_sage_const_0xD2F8711CB5502C512ACEA59BE181A8FCF12F183B540D9A6998BF66370F9538F7E39FC507545DAD9AA2E71D3313F0B4408695A0A2C03A790662A9BD01650533C584C90779B73604FB8157F0AB7C9A82E724700E5937D9FF5FCF1EE3BE1EDD7E07B4C0F035A58CC2B9DB8B79F176F595C1B0E90B7957309B96106A50A01B78171599B41C8744BCB1C0E6A24F60AE8946D37F4D4BD8CF286A336E1022996B3BA3918E4D808627D0315BFE291AEB884CBE98BB620DAA735B0467F3287D158231D = Integer(0xD2F8711CB5502C512ACEA59BE181A8FCF12F183B540D9A6998BF66370F9538F7E39FC507545DAD9AA2E71D3313F0B4408695A0A2C03A790662A9BD01650533C584C90779B73604FB8157F0AB7C9A82E724700E5937D9FF5FCF1EE3BE1EDD7E07B4C0F035A58CC2B9DB8B79F176F595C1B0E90B7957309B96106A50A01B78171599B41C8744BCB1C0E6A24F60AE8946D37F4D4BD8CF286A336E1022996B3BA3918E4D808627D0315BFE291AEB884CBE98BB620DAA735B0467F3287D158231D); _sage_const_0x947062E712C031ADD0B60416D3B87D54B50C1EFBC8DBB87346F960B242AF3DF6DD47406FEC98053A967D28FE91B130FF0FE93689122931F0BA6E73A3E9E6C873B8E2344A459244D1295E99A241E59E1EEA796E9738E6B1EDEED3D91AE6747E8ECA634C030B90B02BAF8AE0088058F6994C7CAC232835AC72D8B23A96F10EF03D74F82C49D4513423DAC298698094B5C631B9C7C62850C498330E9D112BB9CAA574AEE6B0E5E66D5B234B23C755AC1719B4B68133E680A7BCF48B4CFD0924D = Integer(0x947062E712C031ADD0B60416D3B87D54B50C1EFBC8DBB87346F960B242AF3DF6DD47406FEC98053A967D28FE91B130FF0FE93689122931F0BA6E73A3E9E6C873B8E2344A459244D1295E99A241E59E1EEA796E9738E6B1EDEED3D91AE6747E8ECA634C030B90B02BAF8AE0088058F6994C7CAC232835AC72D8B23A96F10EF03D74F82C49D4513423DAC298698094B5C631B9C7C62850C498330E9D112BB9CAA574AEE6B0E5E66D5B234B23C755AC1719B4B68133E680A7BCF48B4CFD0924D); _sage_const_1 = Integer(1); _sage_const_0 = Integer(0); _sage_const_7 = Integer(7); _sage_const_131 = Integer(131); _sage_const_22 = Integer(22); _sage_const_8 = Integer(8)
from tqdm import tqdm

q = _sage_const_0xD2F8711CB5502C512ACEA59BE181A8FCF12F183B540D9A6998BF66370F9538F7E39FC507545DAD9AA2E71D3313F0B4408695A0A2C03A790662A9BD01650533C584C90779B73604FB8157F0AB7C9A82E724700E5937D9FF5FCF1EE3BE1EDD7E07B4C0F035A58CC2B9DB8B79F176F595C1B0E90B7957309B96106A50A01B78171599B41C8744BCB1C0E6A24F60AE8946D37F4D4BD8CF286A336E1022996B3BA3918E4D808627D0315BFE291AEB884CBE98BB620DAA735B0467F3287D158231D 
enc = _sage_const_0x947062E712C031ADD0B60416D3B87D54B50C1EFBC8DBB87346F960B242AF3DF6DD47406FEC98053A967D28FE91B130FF0FE93689122931F0BA6E73A3E9E6C873B8E2344A459244D1295E99A241E59E1EEA796E9738E6B1EDEED3D91AE6747E8ECA634C030B90B02BAF8AE0088058F6994C7CAC232835AC72D8B23A96F10EF03D74F82C49D4513423DAC298698094B5C631B9C7C62850C498330E9D112BB9CAA574AEE6B0E5E66D5B234B23C755AC1719B4B68133E680A7BCF48B4CFD0924D 

assert is_prime(q)


def to_bits(m):
    _bin = lambda b: [_sage_const_1  if b & (_sage_const_1  << n) else _sage_const_0  for n in range(_sage_const_7 )]
    return sum([_bin(b) for b in m], [])


def gen_primes(r, n):
    primes = Primes()[:n]
    bound = prod(primes[n - r :])
    return primes, next_prime(bound)


def prod_exp(p, q, b):
    return prod([p[i] ** b[i] for i in range(len(p))]) % q


def encode(r, n, m):
    p, q = gen_primes(r, n)
    return p, q, prod_exp(p, q, to_bits(m))


# m = b"I have a sweet flag for you: CTF{YkDOLIStjpjP5Am1SXDt5d2r9es3b5KZP47v8rXF}"
target = b"YkDOLIStjpjP5Am1SXDt5d2r9es3b5KZP47v8rXF"
dummy = b"\x00" * len(target)
m = b"I have a sweet flag for you: CTF{" + dummy + b"}"
n = _sage_const_7  * len(m)
p, q, x = encode(_sage_const_131 , _sage_const_7  * len(m), m)

print(to_bits(m))
P = Primes()[:n]
print(P)


def check(x):
    for p in P:
        if x % p == _sage_const_0 :
            x //= p
    return x == _sage_const_1 


flag = enc * pow(x, -_sage_const_1 , q) % q

# 後半 SIZE 個を決めうち
SIZE = _sage_const_22 
for bit in tqdm(range(_sage_const_1  << SIZE)):
    t = flag
    S = [i for i in range(SIZE) if bit >> i & _sage_const_1 ]
    # print([P[-s - 2] for s in S])
    for s in S:
        t *= pow(P[-_sage_const_8  - (s * _sage_const_7 )], -_sage_const_1 , q)
        t %= q
    if check(t):
        print("found!")
        print(t)

