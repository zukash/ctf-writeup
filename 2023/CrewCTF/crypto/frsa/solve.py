from json import dump as json_dump
from random import randint
from mpmath import mp
from Crypto.Util.number import bytes_to_long, getPrime, GCD, long_to_bytes
from sympy import symbols, solve

size = 768 // 8
eps = 1e-20

mp.dps = 8 * size * 16

e = 3
p = 968219058480186263364670892282743965499462418709857320927059276494121226295323147778997489260088349256779418999440618880030060948324290988331392324296640048369958471920240472911772831834997554738434865178326242209338330134170379177
q = 1402722375974832631210604771118782562490917744413211207923417816328611705369557422744332829230538048603329813822326297493086341402215177308545846953188921172315517413060873970698945667366166887149087776890103136984266395215710082699

c = "0.0374329037432080346924942741055333040189179298157335893946619400917460815574465091522672435064338691253010187506159909378888439681119439737023903868621433957289033766238516612093113679318176960125153329764184907162335532732883448960274268808106331814418216911000322708991278458264441173073792121532099340363394551733455926115702943267858814223446328856218814352917994684232221852358414526238583050414159808182693538057991816696737543338220502208292660955176068151750043560095938744187194112957604465680221812671646247486877388516540467833106804269177629366417842872443117186335796301368439107696612710982769535319205352783736013116264741057720032008108727256758102523870475532000658838380535264979106915891996709584355853881627779682756416757589034100047223858625328193494177012720072698062768405725375033164023959206184246089271124987995019152998799338091183481981138349753581636837792434066989324342929982026581036417939084475715046706761173451903290335122751469986269564047688640562240554399380016472599231384259218447914097822079363081854981329616599615568345085510900107564467650260108305816893376572741793606341013078627339470913989651448281611762768388961857131798051119082104568508109012595807322667153594675487888342917618388077792179215426546982901573859951153150828839390445536094144293917508617350359450964610729694924323006247389114379410150367339719156961573429775225716954200526452168235510241465294883046893518562668090873786167488813160023116009168028329781494006994811252184516074507348426109530102433158060862111740713892345245493330736058962706313700190573694178886876487252534617521504238273988510654644135906436231661680205586061450088671639899272983328376555100035179445252912488076084636039487805488873511750027062059171452833143017752517060702493412171606768984384703473635616407242590911544668572982096550571301414609143129428301520405244138248607929962490720753318792040536445321556434424053142613762749841781268024321399241483847350656566653329604739621100222895880676162308435667791311693680189784268859673541286825147751252476517936199348309278976311962520826899992605577496920802452245854427897925364430856086866096230640532241031500483879216616114336899178414605483887587282468652020002943282508467114456357063374439236981938325505113155973620457832942056340209720240929972709569857060022618965118938325661512942237753187968711657165980772676885127681004260838946887818349361316210562545134408660383368125116950574878149443671278778081643365672896969547692482287457195182186304973433129534645635272752851942850363709159508710416144813668225996864014921899583886093291989075162191531621026376254721645657205105342348475737505588021305623969815966539025871868634578092363996216884164089986017871188227101268064401279849608061094518462839093329455791459797041752602751437758055210035224971906949084033432229105290146041882301548472801491891136379270092753927972365135231266234000728832967737369263357322446689395777339901259814541310633017508189155354724919148901347834355822625693127423993587303180421150615663786758286351881468150413947903345235605059863327491528701717789183199740763018650651998425626691243854736854538390587592082905996522562985047052987726428636510352779907529360272788520533773746100016497665070894739490204450350255833153172280995398501559089289483144241549923845213496465630634063929993711659401828002200368768883157392760715359221810629838983270725446827531404542936620845055531290009059847281609212589129119821012348204361123794996486315662685282900165344695096415842290957733485231274169728185423514943955020868642001339978691645087270972629965670824869347014190763516029287970291919397386851315717861860903420412301066832081450763733102012764653892395968327800643355216452156491344100755609434214381320334830675473788978807218975351265227016099026111973233530749250201539106006628071405330432437536630928315056928026253185976542195282052861546889067009755832538628219593849186961502624092010089423230665503306704458594406435711398287856379228826754648405000795548624764977984893501496621275851312715864889436586426948466119875823123233317463418402894316132035145917005115825117645608040534418025089169948674259796631407969174564165439427645386647867261419326244581928105699890759740971673073712355258757986513562052909843107792981830863494788474001314749741333988239706176472125053419872302355283907400927516225424303653707203829323201571980071899460227934527086822768275241120488283302852418486990797732118884037566871587044666238260440360014410174297933872217522365823973525838311810304505018613401501583278757260874209169737825788997471361508186027348617510848756940935216883550459840631202113087466048284397386213007804548417434353995195567713380642149010012418182602039063005702770191969676735618417544215755787899896109866180393845699841488554246408349111994549638211994532730331409625929908435778704962188317581671901168458436536169942880396600219330714474588883432980937882365163274365057792910454837986714050320578934888296364909031301059090577938543955401485061833156167303623375249386037812851022763316983883715620414136622589429682534770063255286964501048303829227153318402972717322246722523682656134423318352989494211834916620765629173346163846719836124201302360640590888342040502240898820686398496971182172662689683671002259797468698084526133926072988258061236946525085699450503703644637341759390182348465728086646481762143864897489485389334605085270335867020023665698000741675087326593672919436353490247638128803681382203872203470247054579323331658567569490150515178503516950838202308057873117560642355038907838680756816993805812141139574890081879130496482465205813049116258083365982573938213861373211886617730538030508718754445769952072278244543663469679963716066699155639113713279818706949800631654937347012837903452555192624555447387890938272947298883892659129677515126024887166340088392732242515927394489178739138257341881744729420606103501282632075832914391722801032718091084558286512054204903779171032331493699108887526107271319067506156104929971465554257135037162587555495826603196693479170821356404932847963101638952033061757008210933277233858205066647325423161649017228665170255768550561310674216317198474734964286830850059360071151154153357245451503212103908311259189744805642542106183267245916527780211592261726277380553369710803219286074197091489960375889438986196314518480291290817318515021435558875480316924385661587394202752889660042810413512712552448431548639734217243713133835038950383240809656174255696471080776105543522099545549436269457930238315933300201340843133810338416707050486765505195653655870310293107171800831502147830924015571273826304471466784567628295574470998033782144015787200204860558849751945470898252578636065059969071038562639372408384621993212257126220774734037328771918537249899495208697318139035017186611139552744319101009337834454219096172455279231605505130286369417061267532289205255018634423786690085964717050676260522963106730567712852016865689664748488030367405701273925027572017709934374173339444747117446016092749769321225824880571194841970224237982574760834466714077517141651159426008767094757928405260288550818455643994265766021610711366779218995404379219902597826267530898057927742979232830612666214156360355155632159179894931128509357301434223182927297741851457803596162656614916792345320271770427027878449480007076534501208401382594216288975967641705950999334753494192970507367725161009040220532815819907876806763425851296725166146125907474460741902566420559073665038422279389443815989701429048914791934649884644162063616135534705480159723735356387656117203216797663255575565412619538671503611403375629502269249115741562681865251632500246767757970082861155860613591501611076198780979195226317793306116044004502634614104198271464111313295699030643852184074743464051737856743652340219471002358097156956122005101556725881377239418558073823768741725696111081950987628310534837568784165060803655329328717421066894807391688952226993531249827442453543750373786565753588139068171967261951373928818845683509101814484899725595161110236442822447908095738373857343935195619111884729943496742382155404342181293959358473936496923656429059912716454752036143208503559835143274788911175646664399855964029706021167527829344796345875337526965356238008257009990537518504592000886271905190004273016437951873794575271101906254098965540980602771204753797465579350171498491128348002211133360991420646965464347654128446693664558794809536125314417283953074704464053405291434354484817937310828500052985868644002137448236460442403278097100771598012570969861921757200692492649035891803641403719430116955276858000410807783430574871179213079774303387448359284242555125730933609274137631685093641851755629595878311696188005871895864907011732113490317527855629636783692663391379230352855323951720549309127370564930680599596143091072430182575361828153548318921062249895316059409080758231822941269727898692407181710589036485949767958344312642621828430720661357284054582631654925090104594750149583403183685133488079297250093203713830891734294387306093480306036657039029744911756100994553912042658954140918371483160118005925974097003605564644099421814646985934445959171050906207195159060226709295412449623588843097345905097533900990842590761567969490200517151201201664264424471350684466397663327276382290787031561489073892525306122083197865991451195724602945541782543417113675992553984839423846752724903500518463882558056659749834790385304344374395382438859149813362841545064605124158547571606148971410239545782085845189689922871025985989529199644442198117152581410978564839881988344091289842873330306498348658709109781246730340000144684441081682319972634626339150033978109675430526594092091614032950797859216474588424715713926975297954377470592546377986370390217316502974715276861024799279393633777812065711997962069628920489150044514015959500701841282669686928788423162416509945124526044833045589217195024879034746944395169683432037935348233483160125848842094234057133458052187011004526708827659409682517710699336500726252038604273851028456440169243141248336168915390984883865979748152896392532779996298617722589853657998061702560028593373469128494978928274260196345560813085724083585827107618835501050639897827966470898503034830020424759976545943731818950282617999871767120024748136698988931727022958071546542469268376979736156625973930272793159616043928531517241024287285637390957530534798308928618847034566547990378502838938072554903595064457558680953875024298042003065680812323748404601900047934643644506413091864880945816232963528570042160161997937886355855374798171632766112801633826746938261665574280143030005043732418989149371244127390342608528295712985944291224158550110866195997613231011733044386454983728216749819725108591971257869641796355507611600325312434341888438193612922847184688070544018254780658198693629067895926205153594831258456567172689578181081975419507880976962573758006832026346939881386705707147116072593953060669099963895729354528293128570512925801997665249015256983117485330125186061976560859290776535449625828724129001089644304916728082746246514033264090329837256178831603746853313655427706128539779681498853061015007124905236792213387859518708457369748029182267734651789865723929834269394852605843056519162989901837050017220584431991344285494102025263668759592095658178786009136257303147529063715303800270589505821909946798197392129281218659606383695931020994867660530273169492007606112240557913771536308006680984346519084526917473850341016343793277796962597205535433633706061598501656448716172197207910800186189041112557944930349398116995100032112541878143874553857460370003049883673753665364894265514916804943665560293280654395016239185375080300642949080285886420670277845197829644455340323822848023599928904302039342556656271408171193348287299650207953928208783610441759620713271161462834602010870978182125523909832945660195290562436322515569414410718315576708757545010754808134543695219810999671622504838361812299610877880081994634854571884831828929058968590405505510304189544150207636251480463762738613942826910145088866410221424011471641002902635661841457698522694391175823989186671254805054380705618968778688605044158125976225238286136003770276594948167949417224734456409570720235522471127130990693502835195317681661487948084374481009556056671637258382641007695"

ciphertext = mp.mpf(c)
print(c)
print(ciphertext)

########################################################
# p, q が既知のとき、flagを復元できるか
########################################################

pc = int(mp.nint(ciphertext * p))

# assert pow(flag, 3) % q == mp.nint(pc * pow(p, -1, q) % q)

f3 = int(mp.nint(pc * pow(p, -1, q) % q))
# assert f3 == pow(flag, 3, q)
d = pow(e, -1, q - 1)
# assert flag == pow(f3, d, q)
print(long_to_bytes(pow(f3, d, q)))
# d = pow(e, -1, (p - 1) * (q - 1))

print(f3)
print(d)
# assert flag == pow(f3, d, p * q)

# assert predict == flag
# p, q が分かれば、p * c * pow(p, -1, q) で m ** 3 が得られる
# あとは普通のRSA暗号のように復号できる


# json_dump(
#     {
#         'n': str(n),
#         'e': str(e),
#         'c': str(ciphertext),
#     },
#     open('output.txt', 'w')
# )
