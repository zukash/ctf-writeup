

# This file was *autogenerated* from the file /Users/zukash/ghq/github.com/zukash/ctf-problems/cakectf_2023/crypto/janken_vs_yoshiking_2/solve.sage
from sage.all_cmdline import *   # import sage library

_sage_const_1 = Integer(1); _sage_const_5 = Integer(5); _sage_const_3 = Integer(3); _sage_const_100 = Integer(100); _sage_const_0 = Integer(0); _sage_const_4 = Integer(4); _sage_const_2 = Integer(2)
from pwn import *

io = remote('crypto.2023.cakectf.com', '10555')
# io = process(['sage', 'server.sage'])

io.recvuntil(b'Here is p:')
p = int(io.recvuntil(b',')[:-_sage_const_1 ])
assert is_prime(p)

io.recvuntil(b'and M:')
M = eval(io.recvuntil(b']'))
M = Matrix(GF(p), _sage_const_5 , _sage_const_5 , M)


period = multiplicative_order(det(M ** _sage_const_3 ))

for x in range(_sage_const_1 , _sage_const_100 ):
    m = multiplicative_order(det(M ** x))
    if period % m == _sage_const_0 :
        print(x)


for _ in range(_sage_const_100 ):
    io.recvuntil(b'my commitment is=')
    commit = eval(io.recvuntil(b']'))
    commit = Matrix(GF(p), _sage_const_5 , _sage_const_5 , commit)
    for hand in range(_sage_const_1 , _sage_const_4 ):
        m = multiplicative_order(det(commit * (M ** hand)))
        print(hand, period % m)

    for hand in range(_sage_const_1 , _sage_const_4 ):
        m = multiplicative_order(det(commit * (M ** hand)))
        if period % m == _sage_const_0 :
            break

    if hand == _sage_const_1 :
        # 相手が Paper
        # 自分は Scissors
        hand = _sage_const_2 
    elif hand == _sage_const_2 :
        # 相手が Scissors
        # 自分は Rock
        hand = _sage_const_1 
    else:
        # 相手が Rock
        # 自分は Paper
        hand = _sage_const_3 

    io.recvuntil(b'your hand(1-3):')
    io.sendline(str(hand).encode())

    print(io.recvline())

io.interactive()

# io.recvuntil
# p_str, M_str = data.groups()
# print(p_str)
# print(M_str)


# io.recvline()

"""
1: Paper
2: Scissors
3: Rock

---
    1: "Rock",
    2: "Scissors",
    3: "Paper"


1 0
2 36810963387870686059270193471878945226769786590437065364785641260384465322267966660822269976008844032598483220703817674127733283653418915399828099
3 446075254334216973666236204492229058257996273902916358090472400793338950775243219995844267569275171987028419668488862575079871931312130416815116903682
[*] Switching to interactive mode
 
[yoshiking]: My hand is ... Paper
[yoshiking]: Your hand is ... Rock
[yoshiking]: Ahahahaha! I'm the winnnnnnner!!!!
[yoshiking]: You, good loser!
[system]: you can check that yoshiking doesn't cheat
[system]: here's the secret value: 1231263691284932485261798484117090622420935397781793564300019158098610565818








1 295619753388070557586959011228733542992019191317817184190952570922867742004222556830665231473191643116725899574011443222783721212860282406192586498830
2 72705300882457097291431139013461274715203932936010128920549082863469685687216565870798138581699863039037358478605864048889257553580984359614507255
3 0
[*] Switching to interactive mode
 
[yoshiking]: My hand is ... Rock
[yoshiking]: Your hand is ... Paper
[yoshiking]: Yo! You win!!! Ho!
[system]: wins: 1
"""

