/* This file was generated by the Hex-Rays decompiler version 8.4.0.240320.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>

//-------------------------------------------------------------------------
// Function declarations

__int64 (**init_proc())(void);
__int64 sub_401020();
__int64 sub_401030();  // weak
__int64 sub_401040();  // weak
__int64 sub_401050();  // weak
__int64 sub_401060();  // weak
__int64 sub_401070();  // weak
__int64 sub_401080();  // weak
__int64 sub_401090();  // weak
__int64 sub_4010A0();  // weak
__int64 sub_4010B0();  // weak
__int64 sub_4010C0();  // weak
__int64 sub_4010D0();  // weak
__int64 sub_4010E0();  // weak
__int64 sub_4010F0();  // weak
__int64 sub_401100();  // weak
__int64 sub_401110();  // weak
__int64 sub_401120();  // weak
__int64 sub_401130();  // weak
__int64 sub_401140();  // weak
// int setvbuf(FILE *stream, char *buf, int modes, size_t n);
// int printf(const char *format, ...);
// __int64 __fastcall std::ostringstream::~ostringstream(_QWORD); weak
// __int64 __fastcall std::string::~string(_QWORD); weak
// __int64 __fastcall std::ostream::operator<<(_QWORD, double); weak
// int system(const char *command);
// int __fastcall __cxa_atexit(void (__fastcall *lpfunc)(void *), void *obj,
// void *lpdso_handle);
// __int64 __fastcall std::ostringstream::str(_QWORD, _QWORD); weak
// __int64 __fastcall std::string::substr(_QWORD, _QWORD, _QWORD, _QWORD); weak
// __int64 __isoc99_scanf(const char *, ...); weak
// void __noreturn exit(int status);
// __int64 __fastcall std::string::find(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall std::ostringstream::basic_ostringstream(_QWORD); weak
// ssize_t read(int fd, void *buf, size_t nbytes);
// __int64 __fastcall std::string::length(_QWORD); weak
// _QWORD std::ios_base::Init::Init(std::ios_base::Init *__hidden this); idb
// int puts(const char *s);
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void));
void dl_relocate_static_pie();
FILE **deregister_tm_clones();
__int64 register_tm_clones();
FILE **_do_global_dtors_aux();
__int64 frame_dummy();  // weak
int setup(void);
int banner(void);
__int64 __fastcall checkDecimalPlaces(float a1);  // idb
void __fastcall Calculator::Calculator(Calculator *this);
__int64 __fastcall Calculator::setnumber_floater(Calculator *this);  // idb
int win(void);
Calculator *__fastcall Calculator::setnumber_integer(Calculator *this);
ssize_t __fastcall Calculator::Backdoor(Calculator *this);
int __fastcall main(int argc, const char **argv, const char **envp);
int __fastcall __static_initialization_and_destruction_0(int a1, int a2);
int GLOBAL__sub_I__Z5setupv();
void term_proc();
// int __fastcall _libc_start_main(int (__fastcall *main)(int, char **, char
// **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void
// (*rtld_fini)(void), void *stack_end); void __fastcall
// std::ios_base::Init::~Init(std::ios_base::Init *__hidden this); idb
// __int64 _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

__int64 (*qword_404010)(void) = NULL;  // weak
_UNKNOWN _dso_handle;                  // weak
FILE *_bss_start;                      // idb
FILE *stdin;                           // idb
FILE *stderr;                          // idb
char completed_0;                      // weak
_UNKNOWN std::__ioinit;                // weak

//----- (0000000000401000) ----------------------------------------------------
__int64 (**init_proc())(void) {
  __int64 (**result)(void);  // rax

  result = &_gmon_start__;
  if (&_gmon_start__) return (__int64 (**)(void))_gmon_start__();
  return result;
}
// 4041A0: using guessed type __int64 _gmon_start__(void);

//----- (0000000000401020) ----------------------------------------------------
__int64 sub_401020() { return qword_404010(); }
// 404010: using guessed type __int64 (*qword_404010)(void);

//----- (0000000000401030) ----------------------------------------------------
__int64 sub_401030() { return sub_401020(); }
// 401030: using guessed type __int64 sub_401030();

//----- (0000000000401040) ----------------------------------------------------
__int64 sub_401040() { return sub_401020(); }
// 401040: using guessed type __int64 sub_401040();

//----- (0000000000401050) ----------------------------------------------------
__int64 sub_401050() { return sub_401020(); }
// 401050: using guessed type __int64 sub_401050();

//----- (0000000000401060) ----------------------------------------------------
__int64 sub_401060() { return sub_401020(); }
// 401060: using guessed type __int64 sub_401060();

//----- (0000000000401070) ----------------------------------------------------
__int64 sub_401070() { return sub_401020(); }
// 401070: using guessed type __int64 sub_401070();

//----- (0000000000401080) ----------------------------------------------------
__int64 sub_401080() { return sub_401020(); }
// 401080: using guessed type __int64 sub_401080();

//----- (0000000000401090) ----------------------------------------------------
__int64 sub_401090() { return sub_401020(); }
// 401090: using guessed type __int64 sub_401090();

//----- (00000000004010A0) ----------------------------------------------------
__int64 sub_4010A0() { return sub_401020(); }
// 4010A0: using guessed type __int64 sub_4010A0();

//----- (00000000004010B0) ----------------------------------------------------
__int64 sub_4010B0() { return sub_401020(); }
// 4010B0: using guessed type __int64 sub_4010B0();

//----- (00000000004010C0) ----------------------------------------------------
__int64 sub_4010C0() { return sub_401020(); }
// 4010C0: using guessed type __int64 sub_4010C0();

//----- (00000000004010D0) ----------------------------------------------------
__int64 sub_4010D0() { return sub_401020(); }
// 4010D0: using guessed type __int64 sub_4010D0();

//----- (00000000004010E0) ----------------------------------------------------
__int64 sub_4010E0() { return sub_401020(); }
// 4010E0: using guessed type __int64 sub_4010E0();

//----- (00000000004010F0) ----------------------------------------------------
__int64 sub_4010F0() { return sub_401020(); }
// 4010F0: using guessed type __int64 sub_4010F0();

//----- (0000000000401100) ----------------------------------------------------
__int64 sub_401100() { return sub_401020(); }
// 401100: using guessed type __int64 sub_401100();

//----- (0000000000401110) ----------------------------------------------------
__int64 sub_401110() { return sub_401020(); }
// 401110: using guessed type __int64 sub_401110();

//----- (0000000000401120) ----------------------------------------------------
__int64 sub_401120() { return sub_401020(); }
// 401120: using guessed type __int64 sub_401120();

//----- (0000000000401130) ----------------------------------------------------
__int64 sub_401130() { return sub_401020(); }
// 401130: using guessed type __int64 sub_401130();

//----- (0000000000401140) ----------------------------------------------------
__int64 sub_401140() { return sub_401020(); }
// 401140: using guessed type __int64 sub_401140();

//----- (0000000000401270) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void)) {
  __int64 v3;     // rax
  int v4;         // esi
  __int64 v5;     // [rsp-8h] [rbp-8h] BYREF
  char *retaddr;  // [rsp+0h] [rbp+0h] BYREF

  v4 = v5;
  v5 = v3;
  _libc_start_main((int(__fastcall *)(int, char **, char **))main, v4, &retaddr,
                   0LL, 0LL, a3, &v5);
  __halt();
}
// 40127A: positive sp value 8 has been found
// 401281: variable 'v3' is possibly undefined

//----- (00000000004012A0) ----------------------------------------------------
void dl_relocate_static_pie() { ; }

//----- (00000000004012B0) ----------------------------------------------------
FILE **deregister_tm_clones() { return &_bss_start; }

//----- (00000000004012E0) ----------------------------------------------------
__int64 register_tm_clones() { return 0LL; }

//----- (0000000000401320) ----------------------------------------------------
FILE **_do_global_dtors_aux() {
  FILE **result;  // rax

  if (!completed_0) {
    result = deregister_tm_clones();
    completed_0 = 1;
  }
  return result;
}
// 4040E8: using guessed type char completed_0;

//----- (0000000000401350) ----------------------------------------------------
__int64 frame_dummy() { return register_tm_clones(); }
// 401350: using guessed type __int64 frame_dummy();

//----- (0000000000401356) ----------------------------------------------------
int setup(void) {
  setvbuf(stdin, 0LL, 2, 0LL);
  setvbuf(_bss_start, 0LL, 2, 0LL);
  return setvbuf(stderr, 0LL, 2, 0LL);
}

//----- (00000000004013BB) ----------------------------------------------------
int banner(void) {
  puts("Best Calculator\n");
  puts("1. Float Calculator");
  return puts("2. Integer Calculator");
}

//----- (00000000004013F3) ----------------------------------------------------
__int64 __fastcall checkDecimalPlaces(float a1) {
  unsigned int v1;  // ebx
  char v3[32];      // [rsp+10h] [rbp-1D0h] BYREF
  char v4[32];      // [rsp+30h] [rbp-1B0h] BYREF
  char v5[376];     // [rsp+50h] [rbp-190h] BYREF
  __int64 v6;       // [rsp+1C8h] [rbp-18h]

  std::ostringstream::basic_ostringstream(v5);
  std::ostream::operator<<(v5,
                           *(double *)_mm_cvtsi32_si128(LODWORD(a1)).m128i_i64);
  std::ostringstream::str(v4, v5);
  v6 = std::string::find(v4, 46LL, 0LL);
  if (v6 == -1) {
    v1 = 1;
  } else {
    std::string::substr(v3, v4, v6 + 1, -1LL);
    LOBYTE(v1) = (unsigned __int64)std::string::length(v3) <= 1;
    std::string::~string(v3);
  }
  std::string::~string(v4);
  std::ostringstream::~ostringstream(v5);
  return v1;
}
// 4014DF: variable 'v1' is possibly undefined
// 401170: using guessed type __int64 __fastcall
// std::ostringstream::~ostringstream(_QWORD); 401180: using guessed type
// __int64 __fastcall std::string::~string(_QWORD); 401190: using guessed type
// __int64 __fastcall std::ostream::operator<<(_QWORD, double); 4011C0: using
// guessed type __int64 __fastcall std::ostringstream::str(_QWORD, _QWORD);
// 4011D0: using guessed type __int64 __fastcall std::string::substr(_QWORD,
// _QWORD, _QWORD, _QWORD); 401200: using guessed type __int64 __fastcall
// std::string::find(_QWORD, _QWORD, _QWORD); 401210: using guessed type __int64
// __fastcall std::ostringstream::basic_ostringstream(_QWORD); 401230: using
// guessed type __int64 __fastcall std::string::length(_QWORD);

//----- (0000000000401522) ----------------------------------------------------
void __fastcall Calculator::Calculator(Calculator *this) {
  *(_DWORD *)this = 0;
  *((_DWORD *)this + 1) = 0;
  *((_DWORD *)this + 2) = 0;
  *((_DWORD *)this + 3) = 0;
  *((_DWORD *)this + 4) = 0;
  *((_DWORD *)this + 5) = 0;
  *(_DWORD *)this = 0;
  *((_DWORD *)this + 1) = 0;
  *((_DWORD *)this + 2) = 0;
  *((_DWORD *)this + 3) = 0;
  *((_DWORD *)this + 4) = 0;
  *((_DWORD *)this + 5) = 0;
  *((_DWORD *)this + 6) = 0;
}

//----- (00000000004015CA) ----------------------------------------------------
__int64 __fastcall Calculator::setnumber_floater(Calculator *this) {
  __int64 result;  // rax

  puts("Floater Calculator");
  printf("> ");
  __isoc99_scanf("%f", (char *)this + 12);
  printf("> ");
  __isoc99_scanf("%f", (char *)this + 16);
  if (*((float *)this + 3) < 0.0 || *((float *)this + 4) < 0.0 ||
      *((float *)this + 3) > 10.0 || *((float *)this + 4) > 10.0) {
    printf("No Hack");
    exit(1);
  }
  if ((unsigned __int8)checkDecimalPlaces(*((float *)this + 3)) != 1) {
    *((_DWORD *)this + 3) = 1065353216;
    *((_DWORD *)this + 4) = 1065353216;
  }
  *((float *)this + 5) = *((float *)this + 3) / *((float *)this + 4);
  *((_DWORD *)this + 6) = (int)*((float *)this + 5);
  result = *((unsigned int *)this + 6);
  if ((int)result < 0) {
    result = (__int64)this;
    --*((_DWORD *)this + 6);
  }
  return result;
}
// 4011E0: using guessed type __int64 __isoc99_scanf(const char *, ...);

//----- (0000000000401740) ----------------------------------------------------
int win(void) { return system("/bin/sh"); }

//----- (000000000040175A) ----------------------------------------------------
Calculator *__fastcall Calculator::setnumber_integer(Calculator *this) {
  Calculator *result;  // rax

  puts("Integer Calculator");
  printf("> ");
  __isoc99_scanf("%d", this);
  printf("> ");
  __isoc99_scanf("%d", (char *)this + 4);
  if (*(int *)this < 0 || *((int *)this + 1) < 0 || *(int *)this > 10 ||
      *((int *)this + 1) > 10) {
    printf("No Hack");
    exit(1);
  }
  *((_DWORD *)this + 2) = *((_DWORD *)this + 1) + *(_DWORD *)this;
  result = this;
  *((_DWORD *)this + 6) = *((_DWORD *)this + 2);
  return result;
}
// 4011E0: using guessed type __int64 __isoc99_scanf(const char *, ...);

//----- (000000000040184C) ----------------------------------------------------
ssize_t __fastcall Calculator::Backdoor(Calculator *this) {
  ssize_t result;    // rax
  __int64 buf[128];  // [rsp+10h] [rbp-400h] BYREF

  memset(buf, 0, sizeof(buf));
  result = *((unsigned int *)this + 6);
  if ((_DWORD)result) {
    puts("Create note");
    printf("> ");
    return read(0, buf, *((int *)this + 6));
  }
  return result;
}

//----- (00000000004018E6) ----------------------------------------------------
int __fastcall __noreturn main(int argc, const char **argv, const char **envp) {
  char v3[28];  // [rsp+0h] [rbp-20h] BYREF
  int v4;       // [rsp+1Ch] [rbp-4h] BYREF

  v4 = 0;
  Calculator::Calculator((Calculator *)v3);
  setup();
  while (1) {
    while (1) {
      banner();
      printf("> ");
      __isoc99_scanf("%d", &v4);
      if (v4 != 1337) break;
      Calculator::Backdoor((Calculator *)v3);
    }
    if (v4 <= 1337) {
      if (v4 == 1) {
        Calculator::setnumber_floater((Calculator *)v3);
      } else if (v4 == 2) {
        Calculator::setnumber_integer((Calculator *)v3);
      }
    }
  }
}
// 4011E0: using guessed type __int64 __isoc99_scanf(const char *, ...);

//----- (0000000000401986) ----------------------------------------------------
int __fastcall __static_initialization_and_destruction_0(int a1, int a2) {
  int result;  // eax

  if (a1 == 1 && a2 == 0xFFFF) {
    std::ios_base::Init::Init((std::ios_base::Init *)&std::__ioinit);
    return __cxa_atexit(
        (void(__fastcall *)(void *)) & std::ios_base::Init::~Init,
        &std::__ioinit, &_dso_handle);
  }
  return result;
}

//----- (00000000004019DC) ----------------------------------------------------
int GLOBAL__sub_I__Z5setupv() {
  return __static_initialization_and_destruction_0(1, 0xFFFF);
}

//----- (00000000004019F8) ----------------------------------------------------
void term_proc() { ; }

// nfuncs=78 queued=38 decompiled=38 lumina nreq=0 worse=0 better=0
// ALL OK, 38 function(s) have been successfully decompiled
